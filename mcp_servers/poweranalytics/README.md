# PowerAnalytics MCP Server

This MCP server enables an LLM to interact with **PowerAnalytics.jl** — a Julia package
for analyzing power system simulation results generated by PowerSimulations.jl.

PowerAnalytics runs locally via the Julia REPL (no remote API calls). The server exposes
tools, resources, and prompts that allow the LLM to generate Julia scripts, execute them,
and interpret the results on behalf of the user.

## Tools

| Tool | Description |
|------|-------------|
| `check_julia_environment` | Verify Julia is available and PowerAnalytics.jl can be loaded |
| `get_active_power_timeseries` | Get generation time series for a component type (high-level, generates script internally) |
| `run_julia_script` | Execute arbitrary Julia code (escape hatch for custom analysis) |
| `list_result_files` | Discover simulation result files and saved outputs |

## Resources

| URI | Description |
|-----|-------------|
| `poweranalytics://api-reference` | PowerAnalytics.jl API reference (functions, usage patterns) |
| `poweranalytics://component-types` | Component types, formulations, and available result variables |

## Prompts

| Prompt | Description |
|--------|-------------|
| `analyze_generation` | Template for analyzing generation time series by component type |
| `compare_scenarios` | Template for comparing generation across simulation scenarios |

## Configuration

Set via environment variables or edit constants in `poweranalytics.py`:

| Variable | Default | Description |
|----------|---------|-------------|
| `JULIA_EXECUTABLE` | `julia` | Path to Julia binary |
| `PA_PROJECT_PATH` | `.` | Julia project with PowerAnalytics.jl |
| `PA_RESULTS_DIR` | `.` | Default directory for simulation results |
| `PA_SCRIPT_TIMEOUT` | `300` | Max seconds for a Julia script to run |
| `PA_SYSIMAGE_PATH` | *(empty)* | Optional path to a precompiled Julia sysimage (see below) |

## Prerequisites

- **Julia** must be installed and available on PATH (or set `JULIA_EXECUTABLE`).
- **PowerAnalytics.jl** and its dependencies (PowerSystems.jl, PowerSimulations.jl, etc.)
  must be available in the target Julia project environment.

## Sysimage (Phase 1 optimisation)

Every MCP tool call launches a fresh Julia process. Julia's JIT compilation adds
~15–30 s of overhead to the first `using` statements. A **precompiled sysimage**
eliminates this cost, bringing per-call latency down to ~2–3 s.

### Build the sysimage

```bash
# Run from the Julia project root (where Project.toml lives):
cd /path/to/PowerAnalytics
julia --project=. /path/to/SIENNA-PA-MCP/mcp_servers/poweranalytics/build_sysimage.jl
```

This produces `pa_sysimage.so` (~500 MB–1 GB). Build time is 5–15 minutes.

### Activate the sysimage

Add `PA_SYSIMAGE_PATH` to the server's `env` block in `.vscode/mcp.json`:

```jsonc
"env": {
    "PA_SYSIMAGE_PATH": "/path/to/PowerAnalytics/pa_sysimage.so",
    ...
}
```

Restart the MCP server. Subsequent tool calls will use the sysimage automatically.
When packages are updated, rebuild the sysimage to stay in sync.

## How to run and use the MCP server

- Open the MCP extension in your editor and go to **MCP: List Servers**.
- Choose the **poweranalytics** server and click **Start Server** if it is not already running.
- If you modify any server code, select the server again and click **Restart Server**.

## Example usage

Ask: *"Get the generation time series for each thermal component in the system"*

The LLM will:
1. Read the `poweranalytics://api-reference` resource to understand the API
2. Call `get_active_power_timeseries` with `component_type="ThermalStandard"`
3. Return a summary of the results with MW values and generation patterns

## Development notes

- Main server file: `poweranalytics.py`
- Entry point: `main.py`
- Tests: `tests/test_poweranalytics_tools.py` (15 tests)
- Dependency manifest: `pyproject.toml`
